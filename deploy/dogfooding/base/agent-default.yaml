# Copyright Contributors to the KubeOpenCode project
# Agent configuration for AI agent with credentials
apiVersion: kubeopencode.io/v1alpha1
kind: Agent
metadata:
  name: default
spec:
  agentImage: quay.io/kubeopencode/kubeopencode-agent-opencode:latest
  executorImage: quay.io/kubeopencode/kubeopencode-agent-devbox:latest
  workspaceDir: /workspace
  command:
    - sh
    - -c
    - /tools/opencode run "$(cat ${WORKSPACE_DIR}/task.md)"
  serviceAccountName: kubeopencode-agent
  maxConcurrentTasks: 3
  # OpenCode configuration using OpenCode Zen provider with MiniMax M2.1 (free)
  # See: https://opencode.ai/docs/zen/
  config: |
    {
      "$schema": "https://opencode.ai/config.json",
      "model": "opencode/minimax-m2.1-free",
      "small_model": "opencode/minimax-m2.1-free"
    }
  credentials:
    # Mount entire secret - all keys become env vars automatically
    - name: git
      secretRef:
        name: git-settings
    - name: opencode
      secretRef:
        name: opencode-credentials
    # GitHub App credentials mounted as directory
    # The devbox image has built-in scripts that automatically use these
    # for transparent gh CLI and git authentication
    - name: github-app
      secretRef:
        name: github-app-credentials
      mountPath: /etc/github-app