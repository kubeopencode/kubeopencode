# Copyright Contributors to the KubeTask project
# CronWorkflow to check and update Go version monthly
apiVersion: kubetask.io/v1alpha1
kind: CronWorkflow
metadata:
  name: go-version-update
spec:
  # Run at 00:00 on the 1st of every month
  schedule: "0 0 1 * *"
  workflowSpec:
    agentRef: dev
    description: |
      检查 Go 语言的最新稳定版本，如果有新版本发布，自动更新当前项目。

      任务步骤：
      1. 访问 https://go.dev/dl/?mode=json 获取最新的 Go 稳定版本
      2. 检查当前项目的 go.mod 文件中的 Go 版本
      3. 如果有新的稳定版本（例如 1.25 -> 1.26），执行以下操作：
         - 创建新分支 `chore/update-go-<new-version>`
         - 更新 go.mod 中的 Go 版本
         - 运行 `go mod tidy` 确保依赖正确
         - 运行测试确保更新不会破坏现有功能
         - 提交更改并创建 PR

      注意事项：
      - 只关注主版本更新（如 1.25 -> 1.26），忽略补丁版本更新（如 1.25.1 -> 1.25.2）
      - 如果测试失败，不要创建 PR，而是记录失败原因
      - PR 标题格式：`chore: update Go version to <new-version>`

      当前项目仓库：kubetask-io/kubetask

---
